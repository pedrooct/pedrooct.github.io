<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="generator" content="Jekyll v3.8.5">
  <link rel="icon" href="./favicon.png">
  <title>Welcome to my page</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>


  <style>
  .bd-placeholder-img {
    font-size: 1.125rem;
    text-anchor: middle;
  }

  @media (min-width: 768px) {
    .bd-placeholder-img-lg {
      font-size: 3.5rem;
    }
  }
  </style>
  <link href="style.css" rel="stylesheet">
</head>
<body class="text-center">
  <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <header class="masthead mb-auto">
      <h2 class="masthead-brand">
        <a href="./index.html">GO back</a>
      </h2>
      <h2>Stats about this page</h2>
    </header>
    <main role="main" class="inner cover">
      <div  id="waiting" class="loader"></div>
      <canvas id="barchartipv" style="display:none;margin-top:50px; width:100%; height:100% "></canvas>
      <canvas id="peichartcountry" style="display:none;margin-top:50px; width:100%; height:100% "></canvas>
    </main>
  </div>
</body>
<script type="text/javascript">

function countryPieMap(dataE){
  labels=[];
  data=[];
  counter=0;
  for (key in dataE){
    labels[counter]=key
    data[counter]=dataE[key]
    counter++;
  }
  var ctx = document.getElementById('peichartcountry').getContext('2d');
  var myDoughnutChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: labels,
        datasets: [{
            label: 'ip version',
            backgroundColor: 'rgb(255, 99, 132)',
            data: data
        }]
    },
    options: {}
  });

}

function ipvData(data){
  var ctx = document.getElementById('barchartipv').getContext('2d');
  var myBarChart = new Chart(ctx, {
    type: 'horizontalBar',
    data: {
        labels: ['ipv4', 'ipv6'],
        datasets: [{
            label: 'ip version',
            backgroundColor: 'rgb(255, 99, 132)',
            data: [data["ipv4"],data["ipv6"]]
        }]
    },
    options: {}
});

}

function statsIO(){
  if (localStorage.getItem("id") !== null){
    axios.get('https://trackio.000webhostapp.com/statsio.php?session='+localStorage.getItem("id")+'&stats=1')
      .then(function(response){
        console.log(response["data"])
        var country={}
        var ipversion={ipv4:0,ipv6:0};
        for (i=0;i< response["data"].length;i++){
          if(response[i]["ip"].split(":").length>1){
            ipversion["ipv4"]=ipversion["ipv4"]+1;
          }
          else{
            ipversion["ipv6"]=ipversion["ipv6"]+1;
          }
          console.log(response[i]["country"]);
          if (response[i]["country"] in country){
            country[response[i]["country"]]=country[response[i]["country"]]+1;
          }
          else{
            country[response[i]["country"]]=1
          }
        }
        ipvData(ipversion);
        countryPieMap(country);


        document.getElementById("waiting").style.display = "none";
        document.getElementById("barchartipv").style.display = "block";
        document.getElementById("peichartcountry").style.display = "block";
    })
  }
}
statsIO();

</script>
