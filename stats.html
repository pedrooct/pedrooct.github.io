<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="generator" content="Jekyll v3.8.5">
  <link rel="icon" href="./favicon.png">
  <title>Welcome to my page</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>


  <style>
  .bd-placeholder-img {
    font-size: 1.125rem;
    text-anchor: middle;
  }

  @media (min-width: 768px) {
    .bd-placeholder-img-lg {
      font-size: 3.5rem;
    }
  }
  </style>
  <link href="style.css" rel="stylesheet">
</head>
<body class="text-center">
  <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <header class="masthead mb-auto">
      <h2 class="masthead-brand">
        <a href="./index.html">GO back</a>
      </h2>
      <h2>Stats about this page</h2>
    </header>
    <main role="main" class="inner cover">
      <h2>Colours are random generated so it's unique for you!</h2>
      <div  id="waiting" class="loader"></div>
      <canvas id="barchartipv" style="display:none;margin-top:50px; width:100%; height:100% "></canvas>
      <canvas id="peichartcountry" style="display:none;margin-top:50px; width:100%; height:100% "></canvas>
      <canvas id="barchartclicks" style="display:none;margin-top:50px; width:100%; height:100% "></canvas>
    </main>
  </div>
</body>
<script type="text/javascript">

function countryPieMap(dataE){
  labels=[];
  data=[];
  counter=0;
  for (key in dataE){
    labels[counter]=key
    data[counter]=dataE[key]
    counter++;
  }
  colours=[]
  for(i=0;i<counter;i++){
    colours[i]='rgb('+Math.floor((Math.random() * 255) + 1)+","+Math.floor((Math.random() * 255) + 1)+","+Math.floor((Math.random() * 255) + 1)+")";
  }
  var ctx = document.getElementById('peichartcountry').getContext('2d');
  var myDoughnutChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: labels,
        datasets: [{
            label: 'Countries reached',
            backgroundColor:colours,
            data: data
        }]
    },
    options: {}
  });

}

function ipvData(data){
  colours=[]
  for(i=0;i<2;i++){
    colours[i]='rgb('+Math.floor((Math.random() * 255) + 1)+","+Math.floor((Math.random() * 255) + 1)+","+Math.floor((Math.random() * 255) + 1)+")";
  }
  var ctx = document.getElementById('barchartipv').getContext('2d');
  var myBarChart = new Chart(ctx, {
    type: 'horizontalBar',
    data: {
        labels: ['ipv4', 'ipv6'],
        datasets: [{
            label: 'ip version',
            backgroundColor:colours,
            data: [data["ipv4"],data["ipv6"]]
        }]
    },
    options: {}
});

}
function clickGraph(data){
  colours=[]
  for(i=0;i<4;i++){
    colours[i]='rgb('+Math.floor((Math.random() * 255) + 1)+","+Math.floor((Math.random() * 255) + 1)+","+Math.floor((Math.random() * 255) + 1)+")";
  }
  var ctx = document.getElementById('barchartclicks').getContext('2d');
  var myBarChart = new Chart(ctx, {
    type: 'horizontalBar',
    data: {
        labels: ['clickprojects', 'clicklinkedin',"clickemail","clickstats"],
        datasets: [{
            label: 'What the user check in the page!',
            backgroundColor:colours,
            data: [data["clickprojects"],data["clicklinkedin"],data["clickemail"],data["clickstats"]]
        }]
    },
    options: {}
});
}
function statsIO(){
  if (localStorage.getItem("id") !== null){
    axios.get('https://trackio.000webhostapp.com/statsio.php?session='+localStorage.getItem("id")+'&stats=1')
      .then(function(response){
        var country={}
        var clkSite={clickprojects:0,clicklinkedin:0,clickemail:0,clickstats:0}
        var ipversion={ipv4:0,ipv6:0};
        for (i=0;i< response["data"].length;i++){
          if(response["data"][i].ip.split(".").length>1){
            ipversion["ipv4"]=ipversion["ipv4"]+1;
          }
          else{
            ipversion["ipv6"]=ipversion["ipv6"]+1;
          }
          if (response["data"][i].country in country){
            country[response["data"][i].country]=country[response["data"][i].country]+1;
          }
          else{
            country[response["data"][i].country]=1
          }
          if(response["data"][i].clkproject!=null){
            clkSite["clickprojects"]=clkSite["clickprojects"]+1;
          }
          if(response["data"][i].clklinkedin!=null){
              clkSite["clicklinkedin"]=clkSite["clicklinkedin"]+1;
          }
          if(response["data"][i].clkemail!=null){
              clkSite["clickemail"]=clkSite["clickemail"]+1;
          }
          if(response["data"][i].clkstats!=null){
              clkSite["clickstats"]=clkSite["clickstats"]+1;
          }
        }
        ipvData(ipversion);
        countryPieMap(country);
        clickGraph(clkSite)


        document.getElementById("waiting").style.display = "none";
        document.getElementById("barchartipv").style.display = "block";
        document.getElementById("peichartcountry").style.display = "block";
        document.getElementById("barchartclicks").style.display = "block";
    })
  }
}
statsIO();

</script>
